# 健保雲端資料擷取器 2.0 資料處理模組

## 概述

健保雲端資料擷取器 2.0 採用模組化設計處理各型別醫療資料。本文件說明各資料處理模組的功能與工作原理。

## 資料處理架構

健保雲端資料擷取器的資料處理架構分為四層：

1. **資料擷取層**：透過內容腳本從健保雲端網頁擷取原始資料
2. **資料處理層**：各專門處理器模組解析及結構化原始資料
3. **資料管理層**：由資料管理器統一管理處理後的資料
4. **顯示層**：React 元件展示處理後的資料

## 主要處理模組

### 資料管理器 (dataManager.js)

- **位置**：`/src/utils/dataManager.js`
- **功能**：作為資料處理的中央樞紐，管理所有處理後的資料
- **核心方法**：
  - `processPatientData()`: 處理患者基本資料
  - `storeProcessedData()`: 儲存處理後的資料
  - `getDataByType()`: 擷取特定型別的資料

### 西藥處理器 (medicationProcessor.js)

- **位置**：`/src/utils/medicationProcessor.js`
- **功能**：處理西藥處方資料，實現藥物名稱簡化和分類
- **核心方法**：
  - `processMedicationData()`: 處理原始藥物資料
  - `simplifyMedicationName()`: 簡化藥物名稱
  - `categorizeMedication()`: 藥物分類

### 中藥處理器 (chineseMedProcessor.js)

- **位置**：`/src/utils/chineseMedProcessor.js`
- **功能**：處理中藥處方資料
- **核心方法**：
  - `processChineseMedData()`: 處理原始中藥資料
  - `extractHerbalComponents()`: 提取方劑組成成分

### 檢驗報告處理器 (labProcessor.js)

- **位置**：`/src/utils/labProcessor.js`
- **功能**：處理各類檢驗報告資料
- **核心方法**：
  - `processLabData()`: 處理原始檢驗資料
  - `categorizeLabTests()`: 依類別分組檢驗項目
  - `checkAbnormalValue()`: 檢查值是否異常

### 檢驗處理子模組

- **位置**：`/src/utils/labProcessorModules/`
- **包含**：各種專門處理不同型別檢驗的子模組
  - 血液檢查處理器
  - 尿液檢查處理器
  - 肝功能檢查處理器
  - 腎功能檢查處理器等

### 影像資料處理器 (imagingProcessor.js)

- **位置**：`/src/utils/imagingProcessor.js`
- **功能**：處理各類影像檢查記錄
- **核心方法**：
  - `processImagingData()`: 處理原始影像資料
  - `categorizeByType()`: 依型別分類影像檢查

### 其他專門處理器

- **出院資料處理器** (`dischargeProcessor.js`)
- **手術資料處理器** (`surgeryProcessor.js`)
- **過敏資料處理器** (`allergyProcessor.js`)
- **患者摘要處理器** (`patientSummaryProcessor.js`)
- **用藥天數處理器** (`medDaysProcessor.js`)

## 資料擷取與解析技術

### 網頁資料擷取

使用 DOM 操作 API 從健保雲端網頁擷取資料，並實現穩健的擷取方法以適應網頁結構變化。

### 資料清洗與結構化

處理從健保雲端擷取的非結構化或半結構化資料，統一格式便於後續處理。

### 文字解析與處理

使用正則表達式解析複雜文字資料，實現智能文字分割和提取。

## 資料整合與分析

### 跨模組資料整合

整合不同處理模組的資料，形成完整的患者資訊視圖，實現資料關聯性分析。

### 趨勢分析

分析歷史檢驗數據，計算變化趨勢，識別異常值和重要變化。

## 設計原則

- **模組化設計**：每個處理器負責單一型別的資料
- **可擴展性**：易於新增支援新的資料型別
- **效能優化**：優化大量資料的處理效能
- **容錯機制**：穩健處理各種異常資料情況

## 開發者指南

### 新增資料處理模組

1. 在 `/src/utils/` 目錄創建新的處理器模組
2. 實現標準處理介面方法
3. 在 `dataManager.js` 中註冊新的處理器
4. 建立對應的 UI 元件顯示處理後的資料

### 擴展現有模組

1. 識別需要擴展的處理器模組
2. 尊重現有的方法簽名和資料結構
3. 擴展處理邏輯，保持向後兼容性
4. 更新相關單元測試

## 常見問題

### 資料擷取失敗

- 確認健保雲端網頁結構是否變更
- 檢查選擇器是否正確
- 確認資料載入是否完成

### 資料處理異常

- 檢查原始資料格式是否符合預期
- 檢查處理邏輯是否處理了所有可能的邊緣情況
- 啟用詳細日誌以追蹤處理流程

### 資料顯示不完整

- 確認所有相關的處理器模組都正確執行
- 檢查資料管理器中的資料存儲狀態
- 確認 UI 元件正確讀取資料
